%idArmazem(<local>,<codigo>)

idArmazem('Arouca',1).
idArmazem('Espinho',2).
idArmazem('Gondomar',3).
idArmazem('Maia',4).
idArmazem('Matosinhos',5).
idArmazem('Oliveira de Azemeis',6).
idArmazem('Paredes',7).
idArmazem('Porto',8).
idArmazem('Povoa de Varzim',9).
idArmazem('Santa Maria da Feira',10).
idArmazem('Santo Tirso',11).
idArmazem('Sao Joao da Madeira',12).
idArmazem('Trofa',13).
idArmazem('Vale de Cambra',14).
idArmazem('Valongo',15).
idArmazem('Vila do Conde',16).
idArmazem('Vila Nova de Gaia',17).

%carateristicasCam(<nome_camiao>,<tara>,<capacidade_carga>,<carga_total_baterias>,<autonomia>,<t_recarr_bat_20a80>).

carateristicasCam(eTruck01,7500,4300,80,100,60).

%dadosCam_t_e_ta(<nome_camiao>,<cidade_origem>,<cidade_destino>,<tempo>,<energia>,<tempo_adicional>).

dadosCam_t_e_ta(eTruck01,1,2,122,42,0).
dadosCam_t_e_ta(eTruck01,1,3,122,46,0).
dadosCam_t_e_ta(eTruck01,1,4,151,54,25).
dadosCam_t_e_ta(eTruck01,1,5,147,52,25).
dadosCam_t_e_ta(eTruck01,1,6,74,24,0).
dadosCam_t_e_ta(eTruck01,1,7,116,35,0).
dadosCam_t_e_ta(eTruck01,1,8,141,46,0).
dadosCam_t_e_ta(eTruck01,1,9,185,74,53).
dadosCam_t_e_ta(eTruck01,1,10,97,30,0).
dadosCam_t_e_ta(eTruck01,1,11,164,64,40).
dadosCam_t_e_ta(eTruck01,1,12,76,23,0).
dadosCam_t_e_ta(eTruck01,1,13,174,66,45).
dadosCam_t_e_ta(eTruck01,1,14,59,18,0).
dadosCam_t_e_ta(eTruck01,1,15,132,51,24).
dadosCam_t_e_ta(eTruck01,1,16,181,68,45).
dadosCam_t_e_ta(eTruck01,1,17,128,45,0).

dadosCam_t_e_ta(eTruck01,2,1,116,42,0).
dadosCam_t_e_ta(eTruck01,2,3,55,22,0).
dadosCam_t_e_ta(eTruck01,2,4,74,25,0).
dadosCam_t_e_ta(eTruck01,2,5,65,22,0).
dadosCam_t_e_ta(eTruck01,2,6,69,27,0).
dadosCam_t_e_ta(eTruck01,2,7,74,38,0).
dadosCam_t_e_ta(eTruck01,2,8,61,18,0).
dadosCam_t_e_ta(eTruck01,2,9,103,44,0).
dadosCam_t_e_ta(eTruck01,2,10,36,14,0).
dadosCam_t_e_ta(eTruck01,2,11,88,41,0).
dadosCam_t_e_ta(eTruck01,2,12,61,19,0).
dadosCam_t_e_ta(eTruck01,2,13,95,42,0).
dadosCam_t_e_ta(eTruck01,2,14,78,34,0).
dadosCam_t_e_ta(eTruck01,2,15,69,30,0).
dadosCam_t_e_ta(eTruck01,2,16,99,38,0).
dadosCam_t_e_ta(eTruck01,2,17,46,14,0).

dadosCam_t_e_ta(eTruck01,3,1,120,45,0).
dadosCam_t_e_ta(eTruck01,3,2,50,22,0).
dadosCam_t_e_ta(eTruck01,3,4,46,15,0).
dadosCam_t_e_ta(eTruck01,3,5,46,14,0).
dadosCam_t_e_ta(eTruck01,3,6,74,37,0).
dadosCam_t_e_ta(eTruck01,3,7,63,23,0).
dadosCam_t_e_ta(eTruck01,3,8,38,8,0).
dadosCam_t_e_ta(eTruck01,3,9,84,36,0).
dadosCam_t_e_ta(eTruck01,3,10,59,28,0).
dadosCam_t_e_ta(eTruck01,3,11,61,27,0).
dadosCam_t_e_ta(eTruck01,3,12,67,32,0).
dadosCam_t_e_ta(eTruck01,3,13,67,29,0).
dadosCam_t_e_ta(eTruck01,3,14,82,38,0).
dadosCam_t_e_ta(eTruck01,3,15,34,8,0).
dadosCam_t_e_ta(eTruck01,3,16,80,30,0).
dadosCam_t_e_ta(eTruck01,3,17,36,10,0).

dadosCam_t_e_ta(eTruck01,4,1,149,54,25).
dadosCam_t_e_ta(eTruck01,4,2,65,24,0).
dadosCam_t_e_ta(eTruck01,4,3,46,16,0).
dadosCam_t_e_ta(eTruck01,4,5,27,10,0).
dadosCam_t_e_ta(eTruck01,4,6,103,47,0).
dadosCam_t_e_ta(eTruck01,4,7,55,27,0).
dadosCam_t_e_ta(eTruck01,4,8,36,10,0).
dadosCam_t_e_ta(eTruck01,4,9,50,26,0).
dadosCam_t_e_ta(eTruck01,4,10,78,34,0).
dadosCam_t_e_ta(eTruck01,4,11,42,19,0).
dadosCam_t_e_ta(eTruck01,4,12,97,42,0).
dadosCam_t_e_ta(eTruck01,4,13,44,11,0).
dadosCam_t_e_ta(eTruck01,4,14,111,48,0).
dadosCam_t_e_ta(eTruck01,4,15,32,13,0).
dadosCam_t_e_ta(eTruck01,4,16,53,14,0).
dadosCam_t_e_ta(eTruck01,4,17,38,11,0).

dadosCam_t_e_ta(eTruck01,5,1,141,51,24).
dadosCam_t_e_ta(eTruck01,5,2,55,20,0).
dadosCam_t_e_ta(eTruck01,5,3,48,14,0).
dadosCam_t_e_ta(eTruck01,5,4,25,9,0).
dadosCam_t_e_ta(eTruck01,5,6,97,44,0).
dadosCam_t_e_ta(eTruck01,5,7,55,28,0).
dadosCam_t_e_ta(eTruck01,5,8,29,7,0).
dadosCam_t_e_ta(eTruck01,5,9,48,24,0).
dadosCam_t_e_ta(eTruck01,5,10,69,30,0).
dadosCam_t_e_ta(eTruck01,5,11,53,26,0).
dadosCam_t_e_ta(eTruck01,5,12,95,36,0).
dadosCam_t_e_ta(eTruck01,5,13,63,20,0).
dadosCam_t_e_ta(eTruck01,5,14,105,45,0).
dadosCam_t_e_ta(eTruck01,5,15,34,14,0).
dadosCam_t_e_ta(eTruck01,5,16,46,18,0).
dadosCam_t_e_ta(eTruck01,5,17,27,7,0).

dadosCam_t_e_ta(eTruck01,6,1,69,23,0).
dadosCam_t_e_ta(eTruck01,6,2,71,27,0).
dadosCam_t_e_ta(eTruck01,6,3,74,38,0).
dadosCam_t_e_ta(eTruck01,6,4,103,46,0).
dadosCam_t_e_ta(eTruck01,6,5,99,44,0).
dadosCam_t_e_ta(eTruck01,6,7,88,48,0).
dadosCam_t_e_ta(eTruck01,6,8,92,38,0).
dadosCam_t_e_ta(eTruck01,6,9,134,66,45).
dadosCam_t_e_ta(eTruck01,6,10,42,14,0).
dadosCam_t_e_ta(eTruck01,6,11,116,56,30).
dadosCam_t_e_ta(eTruck01,6,12,23,9,0).
dadosCam_t_e_ta(eTruck01,6,13,126,58,33).
dadosCam_t_e_ta(eTruck01,6,14,25,9,0).
dadosCam_t_e_ta(eTruck01,6,15,84,44,0).
dadosCam_t_e_ta(eTruck01,6,16,132,60,35).
dadosCam_t_e_ta(eTruck01,6,17,80,38,0).

dadosCam_t_e_ta(eTruck01,7,1,116,36,0).
dadosCam_t_e_ta(eTruck01,7,2,71,38,0).
dadosCam_t_e_ta(eTruck01,7,3,61,22,0).
dadosCam_t_e_ta(eTruck01,7,4,53,26,0).
dadosCam_t_e_ta(eTruck01,7,5,53,28,0).
dadosCam_t_e_ta(eTruck01,7,6,88,48,0).
dadosCam_t_e_ta(eTruck01,7,8,59,26,0).
dadosCam_t_e_ta(eTruck01,7,9,88,48,0).
dadosCam_t_e_ta(eTruck01,7,10,84,44,0).
dadosCam_t_e_ta(eTruck01,7,11,74,22,0).
dadosCam_t_e_ta(eTruck01,7,12,82,42,0).
dadosCam_t_e_ta(eTruck01,7,13,76,31,0).
dadosCam_t_e_ta(eTruck01,7,14,97,49,21).
dadosCam_t_e_ta(eTruck01,7,15,29,16,0).
dadosCam_t_e_ta(eTruck01,7,16,84,42,0).
dadosCam_t_e_ta(eTruck01,7,17,69,30,0).

dadosCam_t_e_ta(eTruck01,8,1,134,46,0).
dadosCam_t_e_ta(eTruck01,8,2,59,18,0).
dadosCam_t_e_ta(eTruck01,8,3,32,6,0).
dadosCam_t_e_ta(eTruck01,8,4,34,10,0).
dadosCam_t_e_ta(eTruck01,8,5,32,7,0).
dadosCam_t_e_ta(eTruck01,8,6,88,38,0).
dadosCam_t_e_ta(eTruck01,8,7,57,26,0).
dadosCam_t_e_ta(eTruck01,8,9,69,30,0).
dadosCam_t_e_ta(eTruck01,8,10,65,26,0).
dadosCam_t_e_ta(eTruck01,8,11,53,22,0).
dadosCam_t_e_ta(eTruck01,8,12,82,34,0).
dadosCam_t_e_ta(eTruck01,8,13,61,24,0).
dadosCam_t_e_ta(eTruck01,8,14,97,40,0).
dadosCam_t_e_ta(eTruck01,8,15,36,12,0).
dadosCam_t_e_ta(eTruck01,8,16,65,23,0).
dadosCam_t_e_ta(eTruck01,8,17,32,6,0).

dadosCam_t_e_ta(eTruck01,9,1,181,72,50).
dadosCam_t_e_ta(eTruck01,9,2,95,41,0).
dadosCam_t_e_ta(eTruck01,9,3,86,35,0).
dadosCam_t_e_ta(eTruck01,9,4,55,24,0).
dadosCam_t_e_ta(eTruck01,9,5,48,23,0).
dadosCam_t_e_ta(eTruck01,9,6,134,65,42).
dadosCam_t_e_ta(eTruck01,9,7,95,47,0).
dadosCam_t_e_ta(eTruck01,9,8,69,28,0).
dadosCam_t_e_ta(eTruck01,9,10,109,51,24).
dadosCam_t_e_ta(eTruck01,9,11,61,29,0).
dadosCam_t_e_ta(eTruck01,9,12,132,57,31).
dadosCam_t_e_ta(eTruck01,9,13,67,19,0).
dadosCam_t_e_ta(eTruck01,9,14,143,66,45).
dadosCam_t_e_ta(eTruck01,9,15,71,34,0).
dadosCam_t_e_ta(eTruck01,9,16,15,3,0).
dadosCam_t_e_ta(eTruck01,9,17,67,28,0).

dadosCam_t_e_ta(eTruck01,10,1,97,30,0).
dadosCam_t_e_ta(eTruck01,10,2,34,14,0).
dadosCam_t_e_ta(eTruck01,10,3,59,27,0).
dadosCam_t_e_ta(eTruck01,10,4,78,33,0).
dadosCam_t_e_ta(eTruck01,10,5,71,30,0).
dadosCam_t_e_ta(eTruck01,10,6,40,14,0).
dadosCam_t_e_ta(eTruck01,10,7,82,42,0).
dadosCam_t_e_ta(eTruck01,10,8,65,24,0).
dadosCam_t_e_ta(eTruck01,10,9,109,52,25).
dadosCam_t_e_ta(eTruck01,10,11,92,46,0).
dadosCam_t_e_ta(eTruck01,10,12,32,6,0).
dadosCam_t_e_ta(eTruck01,10,13,99,46,0).
dadosCam_t_e_ta(eTruck01,10,14,63,17,0).
dadosCam_t_e_ta(eTruck01,10,15,74,34,0).
dadosCam_t_e_ta(eTruck01,10,16,105,46,0).
dadosCam_t_e_ta(eTruck01,10,17,53,23,0).

dadosCam_t_e_ta(eTruck01,11,1,164,65,42).
dadosCam_t_e_ta(eTruck01,11,2,88,41,0).
dadosCam_t_e_ta(eTruck01,11,3,65,28,0).
dadosCam_t_e_ta(eTruck01,11,4,42,18,0).
dadosCam_t_e_ta(eTruck01,11,5,55,25,0).
dadosCam_t_e_ta(eTruck01,11,6,118,57,31).
dadosCam_t_e_ta(eTruck01,11,7,74,23,0).
dadosCam_t_e_ta(eTruck01,11,8,59,23,0).
dadosCam_t_e_ta(eTruck01,11,9,63,28,0).
dadosCam_t_e_ta(eTruck01,11,10,97,46,0).
dadosCam_t_e_ta(eTruck01,11,12,111,52,25).
dadosCam_t_e_ta(eTruck01,11,13,25,7,0).
dadosCam_t_e_ta(eTruck01,11,14,126,58,33).
dadosCam_t_e_ta(eTruck01,11,15,53,25,0).
dadosCam_t_e_ta(eTruck01,11,16,59,27,0).
dadosCam_t_e_ta(eTruck01,11,17,67,27,0).

dadosCam_t_e_ta(eTruck01,12,1,76,23,0).
dadosCam_t_e_ta(eTruck01,12,2,61,19,0).
dadosCam_t_e_ta(eTruck01,12,3,67,32,0).
dadosCam_t_e_ta(eTruck01,12,4,97,41,0).
dadosCam_t_e_ta(eTruck01,12,5,92,38,0).
dadosCam_t_e_ta(eTruck01,12,6,19,8,0).
dadosCam_t_e_ta(eTruck01,12,7,82,42,0).
dadosCam_t_e_ta(eTruck01,12,8,86,33,0).
dadosCam_t_e_ta(eTruck01,12,9,128,61,37).
dadosCam_t_e_ta(eTruck01,12,10,32,6,0).
dadosCam_t_e_ta(eTruck01,12,11,109,50,23).
dadosCam_t_e_ta(eTruck01,12,13,120,53,26).
dadosCam_t_e_ta(eTruck01,12,14,40,10,0).
dadosCam_t_e_ta(eTruck01,12,15,78,38,0).
dadosCam_t_e_ta(eTruck01,12,16,126,54,28).
dadosCam_t_e_ta(eTruck01,12,17,74,32,0).

dadosCam_t_e_ta(eTruck01,13,1,174,65,42).
dadosCam_t_e_ta(eTruck01,13,2,107,35,0).
dadosCam_t_e_ta(eTruck01,13,3,74,29,0).
dadosCam_t_e_ta(eTruck01,13,4,46,11,0).
dadosCam_t_e_ta(eTruck01,13,5,67,20,0).
dadosCam_t_e_ta(eTruck01,13,6,128,57,31).
dadosCam_t_e_ta(eTruck01,13,7,80,30,0).
dadosCam_t_e_ta(eTruck01,13,8,76,20,0).
dadosCam_t_e_ta(eTruck01,13,9,67,20,0).
dadosCam_t_e_ta(eTruck01,13,10,105,47,0).
dadosCam_t_e_ta(eTruck01,13,11,27,7,0).
dadosCam_t_e_ta(eTruck01,13,12,122,52,25).
dadosCam_t_e_ta(eTruck01,13,14,137,58,33).
dadosCam_t_e_ta(eTruck01,13,15,67,17,0).
dadosCam_t_e_ta(eTruck01,13,16,59,15,0).
dadosCam_t_e_ta(eTruck01,13,17,78,22,0).

dadosCam_t_e_ta(eTruck01,14,1,59,18,0).
dadosCam_t_e_ta(eTruck01,14,2,80,35,0).
dadosCam_t_e_ta(eTruck01,14,3,80,38,0).
dadosCam_t_e_ta(eTruck01,14,4,109,46,0).
dadosCam_t_e_ta(eTruck01,14,5,105,45,0).
dadosCam_t_e_ta(eTruck01,14,6,27,9,0).
dadosCam_t_e_ta(eTruck01,14,7,97,48,0).
dadosCam_t_e_ta(eTruck01,14,8,99,38,0).
dadosCam_t_e_ta(eTruck01,14,9,143,66,45).
dadosCam_t_e_ta(eTruck01,14,10,61,17,0).
dadosCam_t_e_ta(eTruck01,14,11,122,57,31).
dadosCam_t_e_ta(eTruck01,14,12,42,10,0).
dadosCam_t_e_ta(eTruck01,14,13,132,58,35).
dadosCam_t_e_ta(eTruck01,14,15,90,44,0).
dadosCam_t_e_ta(eTruck01,14,16,139,61,37).
dadosCam_t_e_ta(eTruck01,14,17,86,38,0).

dadosCam_t_e_ta(eTruck01,15,1,132,51,24).
dadosCam_t_e_ta(eTruck01,15,2,74,30,0).
dadosCam_t_e_ta(eTruck01,15,3,34,8,0).
dadosCam_t_e_ta(eTruck01,15,4,36,12,0).
dadosCam_t_e_ta(eTruck01,15,5,36,14,0).
dadosCam_t_e_ta(eTruck01,15,6,86,44,0).
dadosCam_t_e_ta(eTruck01,15,7,34,16,0).
dadosCam_t_e_ta(eTruck01,15,8,42,13,0).
dadosCam_t_e_ta(eTruck01,15,9,71,35,0).
dadosCam_t_e_ta(eTruck01,15,10,82,36,0).
dadosCam_t_e_ta(eTruck01,15,11,53,25,0).
dadosCam_t_e_ta(eTruck01,15,12,80,38,0).
dadosCam_t_e_ta(eTruck01,15,13,69,18,0).
dadosCam_t_e_ta(eTruck01,15,14,95,45,0).
dadosCam_t_e_ta(eTruck01,15,16,69,29,0).
dadosCam_t_e_ta(eTruck01,15,17,53,17,0).

dadosCam_t_e_ta(eTruck01,16,1,179,68,45).
dadosCam_t_e_ta(eTruck01,16,2,92,37,0).
dadosCam_t_e_ta(eTruck01,16,3,84,31,0).
dadosCam_t_e_ta(eTruck01,16,4,57,16,0).
dadosCam_t_e_ta(eTruck01,16,5,46,18,0).
dadosCam_t_e_ta(eTruck01,16,6,132,60,35).
dadosCam_t_e_ta(eTruck01,16,7,92,42,0).
dadosCam_t_e_ta(eTruck01,16,8,67,23,0).
dadosCam_t_e_ta(eTruck01,16,9,15,3,0).
dadosCam_t_e_ta(eTruck01,16,10,105,46,0).
dadosCam_t_e_ta(eTruck01,16,11,57,28,0).
dadosCam_t_e_ta(eTruck01,16,12,130,52,25).
dadosCam_t_e_ta(eTruck01,16,13,61,15,0).
dadosCam_t_e_ta(eTruck01,16,14,141,61,37).
dadosCam_t_e_ta(eTruck01,16,15,69,29,0).
dadosCam_t_e_ta(eTruck01,16,17,65,24,0).

dadosCam_t_e_ta(eTruck01,17,1,128,46,0).
dadosCam_t_e_ta(eTruck01,17,2,42,14,0).
dadosCam_t_e_ta(eTruck01,17,3,40,11,0).
dadosCam_t_e_ta(eTruck01,17,4,42,13,0).
dadosCam_t_e_ta(eTruck01,17,5,34,10,0).
dadosCam_t_e_ta(eTruck01,17,6,82,38,0).
dadosCam_t_e_ta(eTruck01,17,7,74,30,0).
dadosCam_t_e_ta(eTruck01,17,8,29,6,0).
dadosCam_t_e_ta(eTruck01,17,9,69,31,0).
dadosCam_t_e_ta(eTruck01,17,10,55,24,0).
dadosCam_t_e_ta(eTruck01,17,11,69,29,0).
dadosCam_t_e_ta(eTruck01,17,12,80,30,0).
dadosCam_t_e_ta(eTruck01,17,13,82,23,0).
dadosCam_t_e_ta(eTruck01,17,14,90,38,0).
dadosCam_t_e_ta(eTruck01,17,15,53,18,0).
dadosCam_t_e_ta(eTruck01,17,16,67,25,0).

%entrega(<idEntrega>,<data>,<massaEntrefa>,<armazemEntrega>,<tempoColoc>,<tempoRet>)

entrega(4439, 20221205, 200, 1, 8, 10).
entrega(4438, 20221205, 150, 9, 7, 9).
entrega(4445, 20221205, 100, 3, 5, 7).
entrega(4443, 20221205, 120, 8, 6, 8).
entrega(4449, 20221205, 300, 11, 15, 20).


% Us2




% calcula a tara do camiao dado 

calcula_Tara_Camioes(Nome, Lista_Cargas, Lista_Tara_Carga):- 
carateristicasCam(Nome,Tara_Camiao,_,_,_,_), 
calcula_Tara(Tara_Camiao,Lista_Cargas,Lista_Tara_Carga).

% calcula a Lista de Tara e Carga dada pela soma da Carga mais a tara
calcula_Tara(Tara_Camiao,[],[Tara_Camiao]):-!.

calcula_Tara(Tara_Camiao, [Carga_Camiao|Lista_Cargas], [Carga_Tara|Lista_Tara_Carga]):- 
calcula_Tara(Tara_Camiao,Lista_Cargas, Lista_Tara_Carga), 
Carga_Tara is Carga_Camiao + Tara_Camiao.

% calcula a carga dada uma lista de armazens e uma lista de Cargas tendo em conta as entregas da data dada e soma as suas massas 
carga(_, [], [], 0):-!.
carga(Data, [Armazem_Entrega|Lista_Armazens], [Carga_Camiao|Lista_Cargas], Carga_Camiao):-
carga(Data, Lista_Armazens, Lista_Cargas, Carga_Camiao1), 
entrega(_,Data,Massa_Entrega,Armazem_Entrega,_,_), Carga_Camiao is Massa_Entrega + Carga_Camiao1.



% calcula o tempo necessario para fazer viagens entre trechos de armazens dada uma lista de armazens, para isso calcula a tara a carga a capacidade total e tem em conta as cargas das baterias e os dados do camiao
calcula_tempo(Lista_Armazens,Total_Tempo,Data, Camiao):-
        idArmazem('Matosinhos',ID),
        append([ID|Lista_Armazens],[ID],Rota),
        carga(Data, Lista_Armazens, Lista_Cargas,_), 
        calcula_Tara_Camioes(Camiao,Lista_Cargas, Lista_Tara_Carga),
        carateristicasCam(Camiao,Tara_Camiao,Capacidade_Carga,Carga_Baterias,_,Tempo_Carregamento), 
        Capacidade_Total is Tara_Camiao + Capacidade_Carga,
        tempo(Rota, Lista_Tara_Carga,Capacidade_Total,Carga_Baterias,Carga_Baterias,Tempo_Carregamento,Data,Total_Tempo),!.

% predicado base em que dados 2 armazens calcula o tempo tendo em conta a carga, a bateria gasta, a bateria restante e o tempo exta  

tempo([Armazem1,Armazem2],[Carga_Camiao1],Capacidade_Total,Carga_Baterias, Carga_Maxima_Baterias,_,_,Total_Tempo):-
                                                                                                dadosCam_t_e_ta(_, Armazem1, Armazem2, Tempo_Rota_Maximo, Energia_Gasta_Maxima, Tempo_Adicional),
                                                                                                % calcula a energia da rota para a carga do atual camiao
                                                                                                Energia_Rota is Energia_Gasta_Maxima*Carga_Camiao1/Capacidade_Total,
                                                                                                % calcula o tempo da rota para a carga atual do camiao
                                                                                                Tempo_Rota is Tempo_Rota_Maximo*Carga_Camiao1/Capacidade_Total,
                                                                                                % a energia das baterias que resta é a carga das baterias antes menos a energia gasta 
                                                                                                Energia_Baterias_Restante is Carga_Baterias - Energia_Rota,
                                                                                                % se a eergia restante for menor que 20% o tempo adicional preciso será o tempo adicional do camiao senao e 0
                                                                                                ((Energia_Baterias_Restante < (Carga_Maxima_Baterias * 0.2), Tempo_Adicional_Preciso is Tempo_Adicional,!);
                                                                                                (Tempo_Adicional_Preciso is 0)),
                                                                                                % o tempo total é a soma do tempo da rota com o tempo adicional preciso
                                                                                                Total_Tempo is Tempo_Rota + Tempo_Adicional_Preciso.



% o segundo predicado vai calcular o tempo dada uma lista de armazens tendo em conta o tempo de descarga das entregas, a necessidade de carregar as baterias, a carga do camiao a sua energia 

tempo([Armazem1,Armazem2,Armazem3|Rota],[Carga_Camiao1,Carga_Camiao2|Lista_Tara_Carga], Capacidade_Total,Carga_Baterias,Carga_Maxima_Baterias, Tempo_Carregamento,Data,Total_Tempo):-
                                                % faz a busca dos dados da viagem entre dois armazens
                                                dadosCam_t_e_ta(_, Armazem1, Armazem2, Tempo_Rota_Maximo, Energia_Gasta_Maxima, Tempo_Adicional),
                                                % calculao tempo de rota para a carga atual
                                                Tempo_Rota is Tempo_Rota_Maximo*Carga_Camiao1/Capacidade_Total,
                                                % calcula a energia da rota para carga atual
                                                Energia_Rota is Energia_Gasta_Maxima*Carga_Camiao1/Capacidade_Total,
                                                % calcula a energia restante das baterias atraves da subtracao da energia antes e a que gastou
                                                Energia_Baterias_Restante is Carga_Baterias - Energia_Rota,
                                                % caso a baterias restante seja menor que 20% terá que carregar as baterias até 20% sendo o tempo adicional preciso o tempo adicional ou seja o tempo que demora a carregar ate 20
                                                (( Energia_Baterias_Restante < (Carga_Maxima_Baterias*0.2), 
                                                Energia_Chegada_Armazem is (Carga_Maxima_Baterias * 0.2), 
                                                Tempo_Adicional_Preciso is Tempo_Adicional,!);
                                                % caso nao seja menor que 20 a energia será igual a rsetante e o tempo adicional preciso nao sera nenhum
                                                (Energia_Chegada_Armazem is Energia_Baterias_Restante, Tempo_Adicional_Preciso is 0)),
                                                % busca o tempo de descarga da entrega no dado armazem e data, e os dados do camiao entre o armazem em que chegou e o proximo
                                                entrega(_,Data,_,Armazem2,_,Tempo_Descarregamento_Entregas),
                                                dadosCam_t_e_ta(_, Armazem2, Armazem3, _,  Energia_Max_Proximo_Armazem,_),
                                                % calcula a energia para chegar ao rpoximo armazem tendo em conta a carga 
                                                Energia_Proximo_Armazem is Energia_Max_Proximo_Armazem * Carga_Camiao2 / Capacidade_Total,
                                                
                                                %  Se o armazem 3 for matosinhos ou seja o ultimo armazem onde tem que ir, e a energia de chegada menos a do proximo for menor que 20
                                                idArmazem('Matosinhos',ID),
                                                ((Armazem3 == ID, Energia_Chegada_Armazem - Energia_Proximo_Armazem < (Carga_Maxima_Baterias * 0.2), 
                                                % a quantidade de carregamento sera 20% - a energia de chegada menos a energia do proximo armazem ou seja é a energia que necessia carregar ate chegar a 20%
                                                Quantidade_Carregamento is ((Carga_Maxima_Baterias * 0.2) - (Energia_Chegada_Armazem - Energia_Proximo_Armazem)), 
                                                % o tempo que demora a carregar vai ser a quantidade que carregamento * o tempo que demora a carregar 60% a dividir por 60% da carga maxima das baterias
                                                Tempo_Carregar_Baterias is Quantidade_Carregamento * Tempo_Carregamento/(Carga_Maxima_Baterias * 0.6),
                                                % a bateria necessaria seguinte sera entao a quantidade de carregamento mais a energia de chegada ao armazem
                                                Bateria_Seguinte_Carga is Quantidade_Carregamento + Energia_Chegada_Armazem,!);
                                                
                                                
                                                % se o proximo armazem no for matosinhos e a sua energia for maior que a energia com que chegou 
                                                (((Energia_Proximo_Armazem>Energia_Chegada_Armazem,
                                                % a bateria seguinte tera que ser 80%
                                                Bateria_Seguinte_Carga is (Carga_Maxima_Baterias * 0.8), 
                                                % o tempo que demorara a carregar as baterias ser o que falta para carregar ate aos 80% * tempo de carregamento de 60% sobre a carga de 60%
                                                Tempo_Carregar_Baterias is ((Carga_Maxima_Baterias * 0.8) - Energia_Chegada_Armazem)*Tempo_Carregamento/(Carga_Maxima_Baterias * 0.6),!);
                                                
                                                % Se a que temos na chegada menos a energia para chegar ao proximo armazem for menor que 20%, iremos carregar até ao 80%
                                                ((Energia_Chegada_Armazem-Energia_Proximo_Armazem<(Carga_Maxima_Baterias * 0.2), 
                                                % bateria sera 80%
                                                Bateria_Seguinte_Carga is (Carga_Maxima_Baterias * 0.8), 
                                                % o tempo que demorara a carregar as baterias ser o que falta para carregar ate aos 80% * tempo de carregamento de 60% sobre a carga de 60%
                                                Tempo_Carregar_Baterias is ((Carga_Maxima_Baterias * 0.8) - Energia_Chegada_Armazem)*Tempo_Carregamento/(Carga_Maxima_Baterias * 0.6),!);

                                                % Senao a bateria seguinte sera a energia que restou e o tempo de carregar nao sera nenhum
                                                (Bateria_Seguinte_Carga is Energia_Baterias_Restante, 
                                                Tempo_Carregar_Baterias is 0))))),

                                                % se o tempo de carregar as baterias for maior que o tempo de desarregamento da mercadoria entao o tempo de espera sera o tempo de carregar as baterias
                                                ((Tempo_Carregar_Baterias > Tempo_Descarregamento_Entregas, Tempo_Espera is Tempo_Carregar_Baterias,!);
                                                % senao sera o tempo de descarregar a mercadoria
                                                (Tempo_Espera is Tempo_Descarregamento_Entregas)),

                                                % apos os calculos retorna a chamar o metodo recursivamente enviaando os proximos valores da lista
                                                tempo([Armazem2,Armazem3|Rota],[Carga_Camiao2|Lista_Tara_Carga], Capacidade_Total, Bateria_Seguinte_Carga, Carga_Maxima_Baterias ,Tempo_Carregamento, Data, Total_Tempo1),
                                                
                                                % calcula o tempo total somando o tempo anterior aos tempos calculados 
                                                Total_Tempo is Total_Tempo1 + Tempo_Rota + Tempo_Adicional_Preciso + Tempo_Espera.




% calcula a melhor soluçao de viagem tendo em conta o melhor tempo
melhorTempoViagem(Lista,Tempo,Data, Camiao):- get_time(Ti),
                                    (run(Data, Camiao);true),tempo_menor(Lista,Tempo),
                                    get_time(Tf),
                                    TSolucao is Tf-Ti,
                                    write(TSolucao),nl.

run(Data, Camiao):- retractall(tempo_menor(_,_)), 
                    assertz(tempo_menor(_,1000000)),
                    findall(ID, entrega(_,Data,_,ID,_,_),ListaArmazens),
                    permutation(ListaArmazens,ListaArmazensPerm),
                    calcula_tempo(ListaArmazensPerm,Tempo,Data, Camiao),
                    atualiza(ListaArmazensPerm,Tempo),
                    fail.

atualiza(ListaArmazensPerm,Tempo):-tempo_menor(_,Tempo_Minimo),
                ((Tempo<Tempo_Minimo,!,retract(tempo_menor(_,_)),
                assertz(tempo_menor(ListaArmazensPerm,Tempo)));true).







